<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Availability - Staff Scheduler Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=2">
    <link rel="stylesheet" href="{{ url_for('static', filename='employee.css') }}?v=2">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body class="employee-view">
    <!-- Toast Notifications Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header employee-header">
            <div class="header-left">
                <a href="/" class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span class="logo-text">Staff Scheduler</span>
                </a>
                <div class="employee-business-badge">
                    <span class="business-name">{{ business.name }}</span>
                </div>
            </div>
            <div class="header-center">
                <nav class="main-nav employee-nav">
                    <a href="{{ url_for('employee_schedule', business_slug=business_slug, employee_id=employee_id) }}" class="nav-tab" data-tab="schedule">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <span class="tab-text">My Schedule</span>
                    </a>
                    <a href="{{ url_for('employee_availability', business_slug=business_slug, employee_id=employee_id) }}" class="nav-tab active" data-tab="availability">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                        <span class="tab-text">My Availability</span>
                    </a>
                </nav>
            </div>
            <div class="header-right header-right-compact">
                <!-- PTO Notification Bell -->
                <div class="notification-bell-wrapper pto-notification-wrapper">
                    <button class="notification-bell pto-bell" id="ptoNotificationBell" title="Time Off Updates">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span class="notification-badge pto-badge" id="ptoNotificationBadge"></span>
                    </button>
                    
                    <!-- PTO Dropdown -->
                    <div class="notification-dropdown pto-dropdown" id="ptoNotificationDropdown">
                        <div class="notification-header notification-dropdown-header">
                            <span>Time Off Updates</span>
                            <button class="notification-close-mobile" id="closePTONotificationsMobile" aria-label="Close">&times;</button>
                        </div>
                        <div class="notification-list" id="ptoNotificationList">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Hamburger Menu Button -->
                <button class="hamburger-menu-btn" id="hamburgerMenuBtn" title="Menu">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Slide-out Menu Panel -->
            <div class="slide-menu-overlay" id="slideMenuOverlay"></div>
            <div class="slide-menu" id="slideMenu">
                <div class="slide-menu-header">
                    <div class="slide-menu-user">
                        <div class="user-avatar" style="background: {{ employee.color }}">
                            {{ employee.name[0]|upper }}
                        </div>
                        <div class="slide-menu-user-info">
                            <span class="user-name">{{ employee.name }}</span>
                            <span class="business-name">{{ business.name }}</span>
                        </div>
                    </div>
                    <button class="slide-menu-close" id="slideMenuClose">&times;</button>
                </div>
                <nav class="slide-menu-nav">
                    <a href="{{ url_for('employee_schedule', business_slug=business_slug, employee_id=employee_id) }}" class="slide-menu-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <span>My Schedule</span>
                    </a>
                    <a href="{{ url_for('employee_availability', business_slug=business_slug, employee_id=employee_id) }}" class="slide-menu-item active">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span>My Availability</span>
                    </a>
                </nav>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="app-main">
            <!-- Availability Editor -->
            <section id="tab-availability" class="tab-content active">
                <div class="tab-header">
                    <div class="tab-header-left">
                        <h1>My Availability</h1>
                        <p class="tab-subtitle">Set the times you're available to work</p>
                    </div>
                    <div class="tab-header-right">
                        <button id="saveAvailabilityBtn" class="btn btn-primary">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                <polyline points="7 3 7 8 15 8"></polyline>
                            </svg>
                            Save Changes
                        </button>
                    </div>
                </div>

                <div class="employee-availability-layout">
                    <!-- Employee Info Card -->
                    <div class="employee-info-card panel-card">
                        <div class="employee-profile">
                            <div class="employee-avatar-large" style="background: {{ employee.color }}">
                                {{ employee.name[0]|upper }}
                            </div>
                            <div class="employee-details">
                                <h2>{{ employee.name }}</h2>
                                <div class="employee-badges">
                                    {% if employee.classification == 'full_time' %}
                                    <span class="badge badge-ft">Full-Time</span>
                                    {% else %}
                                    <span class="badge badge-pt">Part-Time</span>
                                    {% endif %}
                                    {% for role_id in employee.roles %}
                                    {% for role in roles if role.id == role_id %}
                                    <span class="badge" style="background: {{ role.color }}20; color: {{ role.color }}; border: 1px solid {{ role.color }}40">{{ role.name }}</span>
                                    {% endfor %}
                                    {% endfor %}
                                </div>
                                <p class="employee-hours-info">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    {{ employee.min_hours }}-{{ employee.max_hours }} hours/week
                                </p>
                            </div>
                        </div>
                        <div class="availability-stats">
                            <div class="stat-item">
                                <span class="stat-value" id="totalAvailableHours">â€”</span>
                                <span class="stat-label">Hours Available</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="daysAvailable">â€”</span>
                                <span class="stat-label">Days Available</span>
                            </div>
                        </div>
                    </div>

                    <!-- Availability Editor -->
                    <div class="availability-editor-card panel-card">
                        <div class="availability-instructions">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            <span>Set your available hours for each day. Tap a day to add or edit time ranges.</span>
                        </div>

                        <!-- Time Range Cards View (Mobile-friendly) -->
                        <div class="availability-cards-view" id="availabilityCardsView">
                            <!-- Generated by JavaScript -->
                        </div>

                        <!-- Save Status -->
                        <div class="availability-legend-bar">
                            <div class="legend-items">
                                <span class="legend-item"><span class="legend-dot available"></span> Available</span>
                                <span class="legend-item"><span class="legend-dot unavailable"></span> Not Available</span>
                            </div>
                            <span class="save-status" id="saveStatus"></span>
                        </div>
                    </div>

                    <!-- PTO Requests Section -->
                    <div class="pto-requests-card panel-card">
                        <div class="pto-header">
                            <h3 class="card-title">
                                <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                    <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01"></path>
                                </svg>
                                Time Off Requests
                            </h3>
                            <button class="btn btn-sm btn-primary" id="newPtoRequestBtn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                Request Time Off
                            </button>
                        </div>
                        <div class="pto-requests-list" id="ptoRequestsList">
                            <!-- Populated by JS -->
                            <div class="pto-empty-state" id="ptoEmptyState">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="40" height="40">
                                    <path d="M19 4H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path>
                                    <path d="M16 2v4M8 2v4M3 10h18"></path>
                                    <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01"></path>
                                </svg>
                                <p>No time off requests yet</p>
                                <span>Click the button above to request time off</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- PTO Request Modal -->
    <div class="modal-overlay" id="ptoRequestModal">
        <div class="modal-content pto-modal">
            <div class="modal-header">
                <h2>Request Time Off</h2>
                <button class="modal-close" id="closePtoModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="pto-form-group">
                    <label for="ptoStartDate">Start Date *</label>
                    <input type="date" id="ptoStartDate" required>
                </div>
                
                <div class="pto-form-group">
                    <label for="ptoEndDate">End Date</label>
                    <input type="date" id="ptoEndDate">
                    <span class="form-hint">Leave blank for single day</span>
                </div>
                
                <div class="pto-form-group">
                    <label for="ptoType">Type</label>
                    <select id="ptoType">
                        <option value="vacation">ðŸŒ´ Vacation</option>
                        <option value="sick">ðŸ¤’ Sick</option>
                        <option value="personal">ðŸ‘¤ Personal</option>
                        <option value="other">ðŸ“‹ Other</option>
                    </select>
                </div>
                
                <div class="pto-form-group">
                    <label for="ptoNote">Note (optional)</label>
                    <textarea id="ptoNote" placeholder="Add any details about your request..." rows="2"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPtoBtn">Cancel</button>
                <button class="btn btn-primary" id="submitPtoBtn">Submit Request</button>
            </div>
        </div>
    </div>

    <!-- Pass data to JavaScript -->
    <script>
        const EMPLOYEE_DATA = {
            business: {{ business_data|tojson|safe }},
            employee: {{ employee_data|tojson|safe }},
            roles: {{ roles_data|tojson|safe }},
            days: {{ days|tojson|safe }},
            daysOpen: {{ days_open|tojson|safe }},
            hours: {{ hours|tojson|safe }},
            startHour: {{ start_hour|tojson|safe }},
            endHour: {{ end_hour|tojson|safe }},
            businessSlug: {{ business_slug|tojson|safe }},
            availability: {{ availability_data|tojson|safe }}
        };
    </script>
    <script src="{{ url_for('static', filename='employee.js') }}?v=2"></script>
</body>
</html>



