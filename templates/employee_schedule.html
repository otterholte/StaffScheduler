<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Schedule - Staff Scheduler Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='employee.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body class="employee-view">
    <!-- Toast Notifications Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header employee-header">
            <div class="header-left">
                <a href="/" class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span class="logo-text">Staff Scheduler</span>
                </a>
                <div class="employee-business-badge">
                    <span class="business-name">{{ business.name }}</span>
                </div>
            </div>
            <div class="header-center">
                <nav class="main-nav employee-nav">
                    <a href="{{ url_for('employee_schedule', business_slug=business_slug, employee_id=employee_id) }}" class="nav-tab active" data-tab="schedule">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <span class="tab-text">My Schedule</span>
                    </a>
                    <a href="{{ url_for('employee_availability', business_slug=business_slug, employee_id=employee_id) }}" class="nav-tab" data-tab="availability">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                        <span class="tab-text">My Availability</span>
                    </a>
                </nav>
            </div>
            <div class="header-right">
                <!-- PTO Notification Bell -->
                <div class="notification-bell-wrapper pto-notification-wrapper">
                    <button class="notification-bell pto-bell" id="ptoNotificationBell" title="Time Off Updates">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span class="notification-badge pto-badge" id="ptoNotificationBadge"></span>
                    </button>
                    
                    <!-- PTO Dropdown (hidden by default) -->
                    <div class="notification-dropdown pto-dropdown" id="ptoNotificationDropdown">
                        <div class="notification-header">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 6px;">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <span>Time Off Updates</span>
                        </div>
                        <div class="notification-list" id="ptoNotificationList">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Swap Notification Bell -->
                <div class="notification-bell-wrapper">
                    <button class="notification-bell" id="swapNotificationBell" title="Swap Requests">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span class="notification-badge" id="swapNotificationBadge"></span>
                    </button>
                    
                    <!-- Dropdown (hidden by default) -->
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <span>Pending Requests</span>
                        </div>
                        <div class="notification-list" id="notificationList">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
                
                <div class="employee-user-badge">
                    <div class="user-avatar" style="background: {{ employee.color }}">
                        {{ employee.name[0]|upper }}
                    </div>
                    <span class="user-name">{{ employee.name }}</span>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="app-main">
            <!-- Schedule View (Read-Only) -->
            <section id="tab-schedule" class="tab-content active">
                <div class="tab-header">
                    <div class="tab-header-left">
                        <h1>My Weekly Schedule</h1>
                        <p class="tab-subtitle">View your assigned shifts for the week</p>
                    </div>
                </div>

                <div class="schedule-layout employee-schedule-layout">
                    <!-- Schedule Panel -->
                    <div class="schedule-panel">
                        <div class="panel-card">
                            <div class="schedule-toolbar employee-toolbar">
                                <div class="toolbar-left">
                                    <!-- View Toggle -->
                                    <div class="view-toggle" id="viewToggle">
                                        <button class="view-toggle-btn active" data-view="timeline" title="Timeline View - Days as rows">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                                <line x1="3" y1="18" x2="21" y2="18"></line>
                                                <rect x="5" y="4" width="4" height="4" rx="1"></rect>
                                                <rect x="11" y="10" width="6" height="4" rx="1"></rect>
                                                <rect x="7" y="16" width="5" height="4" rx="1"></rect>
                                            </svg>
                                            Timeline
                                        </button>
                                        <button class="view-toggle-btn" data-view="grid" title="Hourly Grid View">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="14" width="7" height="7"></rect>
                                                <rect x="3" y="14" width="7" height="7"></rect>
                                            </svg>
                                            Grid
                                        </button>
                                        <button class="view-toggle-btn" data-view="table" title="Table View">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                            </svg>
                                            Table
                                        </button>
                                    </div>
                                </div>
                                <div class="toolbar-center">
                                    <!-- Week Navigation -->
                                    <div class="week-nav-inline" id="weekNavigationBar">
                                        <button class="week-nav-arrow" id="weekNavPrev" title="Previous week">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="15 18 9 12 15 6"></polyline>
                                            </svg>
                                        </button>
                                        <span class="week-date-range" id="weekDateRange">Loading...</span>
                                        <button class="week-nav-arrow" id="weekNavNext" title="Next week">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="9 18 15 12 9 6"></polyline>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="toolbar-right">
                                    <!-- Filter Toggle: Mine / Everyone (icons only) -->
                                    <div class="filter-toggle filter-toggle-icons" id="filterToggle">
                                        <button class="filter-toggle-btn active" data-filter="mine" title="Show only my shifts">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                        </button>
                                        <button class="filter-toggle-btn" data-filter="everyone" title="Show all staff shifts">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="9" cy="7" r="4"></circle>
                                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <!-- Color Mode Toggle: By Role / By Staff (matches manager view icons) -->
                                    <div class="filter-toggle filter-toggle-icons color-mode-toggle" id="colorModeToggle" title="Color code by...">
                                        <button class="filter-toggle-btn active" data-color="role" title="Color by role">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                                            </svg>
                                        </button>
                                        <button class="filter-toggle-btn" data-color="employee" title="Color by staff member">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Timeline View (Days as rows) -->
                            <div class="schedule-view schedule-view-timeline active" id="scheduleViewTimeline">
                                <div class="timeline-wrapper" id="timelineWrapper">
                                    <div class="timeline-grid employee-timeline" id="timelineGrid">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Grid View (Hours as rows, Days as columns) -->
                            <div class="schedule-view schedule-view-grid" id="scheduleViewGrid">
                                <div class="schedule-grid-wrapper" id="scheduleGridWrapper">
                                    <table class="schedule-grid employee-grid" id="scheduleGrid">
                                        <thead>
                                            <tr>
                                                <th class="time-col">Time</th>
                                                <!-- Day columns rebuilt by JS with dates -->
                                            </tr>
                                        </thead>
                                        <tbody id="scheduleGridBody">
                                            <!-- Populated by JS -->
                                        </tbody>
                                    </table>
                                    <div id="scheduleEvents" class="schedule-events">
                                        <!-- Shift blocks positioned here -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Table View (Simple table like manager view) -->
                            <div class="schedule-view schedule-view-table" id="scheduleViewTable">
                                <div class="simple-table-wrapper">
                                    <table class="simple-schedule-table" id="simpleScheduleTable">
                                        <thead>
                                            <tr>
                                                <th class="name-col">Name</th>
                                                <!-- Day columns rebuilt by JS with dates -->
                                                <th class="hours-col">Hours</th>
                                            </tr>
                                        </thead>
                                        <tbody id="simpleScheduleBody">
                                            <!-- Populated by JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- Schedule Legend -->
                            <div class="schedule-legend-wrapper" id="scheduleLegendWrapper">
                                <div class="legend-title">Roles</div>
                                <div class="schedule-legend" id="scheduleLegend">
                                    {% for role in roles %}
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: {{ role.color }}"></span>
                                        <span class="legend-label">{{ role.name }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Hours Summary -->
                <div class="panel-card employee-hours-summary">
                    <h3 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        My Hours This Week
                    </h3>
                    <div class="hours-summary-content">
                        <div class="hours-stat">
                            <span class="hours-value" id="myScheduledHours">â€”</span>
                            <span class="hours-label">Scheduled Hours</span>
                        </div>
                        <div class="hours-stat">
                            <span class="hours-value" id="myShiftCount">â€”</span>
                            <span class="hours-label">Shifts</span>
                        </div>
                        <div class="hours-stat">
                            <span class="hours-value secondary" id="myHoursRange">{{ employee.min_hours }}-{{ employee.max_hours }}</span>
                            <span class="hours-label">Target Range</span>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Shifts -->
                <div class="panel-card upcoming-shifts-card">
                    <h3 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Upcoming Shifts
                    </h3>
                    <div class="upcoming-shifts-list" id="upcomingShiftsList">
                        <!-- Populated by JS -->
                        <p class="no-shifts-message" id="noShiftsMessage">No upcoming shifts scheduled</p>
                    </div>
                </div>

                <!-- Incoming Swap Requests -->
                <div class="panel-card swap-requests-card" id="incomingSwapsCard" style="display: none;">
                    <h3 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="17 1 21 5 17 9"></polyline>
                            <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                            <polyline points="7 23 3 19 7 15"></polyline>
                            <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                        </svg>
                        Shift Swap Requests
                        <span class="swap-badge" id="swapRequestCount">0</span>
                    </h3>
                    <div class="swap-requests-list" id="incomingSwapsList">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- My Outgoing Swap Requests -->
                <div class="panel-card outgoing-swaps-card" id="outgoingSwapsCard" style="display: none;">
                    <h3 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        My Swap Requests
                    </h3>
                    <div class="outgoing-swaps-list" id="outgoingSwapsList">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Swap Request Modal -->
    <div class="modal-overlay" id="swapModal" style="display: none;">
        <div class="modal-content swap-modal">
            <div class="modal-header">
                <h2>Request Shift Swap</h2>
                <button class="modal-close" id="closeSwapModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="swap-shift-details" id="swapShiftDetails">
                    <!-- Populated by JS -->
                </div>
                
                <div class="swap-form-group">
                    <label>Note (optional)</label>
                    <textarea id="swapNote" placeholder="Add a note explaining why you need to swap this shift..." rows="3"></textarea>
                </div>
                
                <div class="eligible-staff-section">
                    <h4>Eligible Staff</h4>
                    <p class="eligible-hint">These coworkers can cover your shift. Select specific people or send to all.</p>
                    <div class="eligible-list" id="eligibleStaffList">
                        <div class="loading-spinner">Checking eligibility...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelSwapBtn">Cancel</button>
                <button class="btn btn-primary" id="submitSwapBtn" disabled>Send Request</button>
            </div>
        </div>
    </div>

    <!-- Swap Response Modal -->
    <div class="modal-overlay" id="swapResponseModal" style="display: none;">
        <div class="modal-content swap-response-modal">
            <div class="modal-header">
                <h2>Respond to Swap Request</h2>
                <button class="modal-close" id="closeSwapResponseModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="swap-request-details" id="swapRequestDetails">
                    <!-- Populated by JS -->
                </div>
                
                <!-- Counter-offer section -->
                <div class="counter-offer-section" id="counterOfferSection">
                    <button class="counter-offer-toggle" id="counterOfferToggle" type="button">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="17 1 21 5 17 9"></polyline>
                            <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                            <polyline points="7 23 3 19 7 15"></polyline>
                            <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                        </svg>
                        Counter with my own shift
                        <span class="toggle-arrow">â€º</span>
                    </button>
                    
                    <div class="counter-offer-shifts" id="counterOfferShifts" style="display: none;">
                        <p class="counter-offer-hint">Select one of your shifts to offer in exchange:</p>
                        <div class="my-shifts-list" id="myShiftsForSwap">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="declineSwapBtn">Decline</button>
                <button class="btn btn-success" id="acceptSwapBtn">Accept Pickup</button>
            </div>
        </div>
    </div>

    <!-- Shift Details Popover -->
    <div class="shift-popover" id="shiftPopover">
        <div class="popover-arrow"></div>
        <div class="popover-content">
            <div class="popover-header">
                <span class="popover-date" id="popoverDate">Friday, Jan 9</span>
                <button class="popover-close" id="popoverClose">&times;</button>
            </div>
            <div class="popover-body">
                <div class="popover-employee" id="popoverEmployee" style="display: none;">
                    <span class="popover-avatar" id="popoverAvatar">A</span>
                    <span class="popover-name" id="popoverName">Ava Smith</span>
                </div>
                <div class="popover-details">
                    <div class="popover-detail">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span id="popoverTime">9:00 AM - 5:00 PM</span>
                    </div>
                    <div class="popover-detail">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                        </svg>
                        <span id="popoverRole">Staff</span>
                    </div>
                    <div class="popover-detail">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                        </svg>
                        <span id="popoverDuration">8 hours</span>
                    </div>
                </div>
                <div class="popover-swap-info" id="popoverSwapInfo" style="display: none;">
                    <div class="swap-info-badge">
                        ðŸ”„ <span id="popoverSwapFrom">Picked up from Johnny Socks</span>
                    </div>
                </div>
            </div>
            <div class="popover-footer" id="popoverFooter">
                <button class="btn btn-swap-action" id="popoverSwapBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="17 1 21 5 17 9"></polyline>
                        <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                        <polyline points="7 23 3 19 7 15"></polyline>
                        <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                    </svg>
                    Request Swap
                </button>
            </div>
        </div>
    </div>

    <!-- Pass data to JavaScript -->
    <script>
        const EMPLOYEE_DATA = {
            business: {{ business_data|tojson|safe }},
            employee: {{ employee_data|tojson|safe }},
            allEmployees: {{ all_employees_data|tojson|safe }},
            roles: {{ roles_data|tojson|safe }},
            days: {{ days|tojson|safe }},
            daysOpen: {{ days_open|tojson|safe }},
            hours: {{ hours|tojson|safe }},
            startHour: {{ start_hour|tojson|safe }},
            endHour: {{ end_hour|tojson|safe }},
            schedule: {{ schedule_data|tojson|safe }},
            businessSlug: {{ business_slug|tojson|safe }}
        };
    </script>
    <script src="{{ url_for('static', filename='employee.js') }}"></script>
</body>
</html>

