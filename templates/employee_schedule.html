<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Schedule - Staff Scheduler Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='employee.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body class="employee-view">
    <!-- Toast Notifications Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header employee-header">
            <div class="header-left">
                <a href="/" class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span class="logo-text">Staff Scheduler</span>
                </a>
                <div class="employee-business-badge">
                    <span class="business-name">{{ business.name }}</span>
                </div>
            </div>
            <div class="header-center">
                <nav class="main-nav employee-nav">
                    <a href="{{ url_for('employee_schedule', business_slug=business_slug, employee_id=employee.id) }}" class="nav-tab active" data-tab="schedule">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <span class="tab-text">My Schedule</span>
                    </a>
                    <a href="{{ url_for('employee_availability', business_slug=business_slug, employee_id=employee.id) }}" class="nav-tab" data-tab="availability">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                        <span class="tab-text">My Availability</span>
                    </a>
                </nav>
            </div>
            <div class="header-right">
                <div class="employee-user-badge">
                    <div class="user-avatar" style="background: {{ employee.color }}">
                        {{ employee.name[0]|upper }}
                    </div>
                    <span class="user-name">{{ employee.name }}</span>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="app-main">
            <!-- Schedule View (Read-Only) -->
            <section id="tab-schedule" class="tab-content active">
                <div class="tab-header">
                    <div class="tab-header-left">
                        <h1>My Weekly Schedule</h1>
                        <p class="tab-subtitle">View your assigned shifts for the week</p>
                    </div>
                </div>

                <div class="schedule-layout employee-schedule-layout">
                    <!-- Schedule Panel -->
                    <div class="schedule-panel">
                        <div class="panel-card">
                            <div class="schedule-toolbar employee-toolbar">
                                <div class="toolbar-left">
                                    <!-- View Toggle -->
                                    <div class="view-toggle" id="viewToggle">
                                        <button class="view-toggle-btn active" data-view="timeline" title="Timeline View - Days as rows">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                                <line x1="3" y1="18" x2="21" y2="18"></line>
                                                <rect x="5" y="4" width="4" height="4" rx="1"></rect>
                                                <rect x="11" y="10" width="6" height="4" rx="1"></rect>
                                                <rect x="7" y="16" width="5" height="4" rx="1"></rect>
                                            </svg>
                                            Timeline
                                        </button>
                                        <button class="view-toggle-btn" data-view="grid" title="Hourly Grid View">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="14" width="7" height="7"></rect>
                                                <rect x="3" y="14" width="7" height="7"></rect>
                                            </svg>
                                            Grid
                                        </button>
                                        <button class="view-toggle-btn" data-view="table" title="Table View">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                            </svg>
                                            Table
                                        </button>
                                    </div>
                                </div>
                                <div class="toolbar-center">
                                    <!-- Week Navigation -->
                                    <div class="week-nav-inline" id="weekNavigationBar">
                                        <button class="week-nav-arrow" id="weekNavPrev" title="Previous week">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="15 18 9 12 15 6"></polyline>
                                            </svg>
                                        </button>
                                        <span class="week-date-range" id="weekDateRange">Loading...</span>
                                        <button class="week-nav-arrow" id="weekNavNext" title="Next week">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="9 18 15 12 9 6"></polyline>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="toolbar-right">
                                    <!-- Filter Toggle: Mine / Everyone (icons only) -->
                                    <div class="filter-toggle filter-toggle-icons" id="filterToggle">
                                        <button class="filter-toggle-btn active" data-filter="mine" title="Show only my shifts">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                        </button>
                                        <button class="filter-toggle-btn" data-filter="everyone" title="Show all staff shifts">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="9" cy="7" r="4"></circle>
                                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Timeline View (Days as rows) -->
                            <div class="schedule-view schedule-view-timeline active" id="scheduleViewTimeline">
                                <div class="timeline-wrapper" id="timelineWrapper">
                                    <div class="timeline-grid employee-timeline" id="timelineGrid">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Grid View (Hours as rows, Days as columns) -->
                            <div class="schedule-view schedule-view-grid" id="scheduleViewGrid">
                                <div class="schedule-grid-wrapper" id="scheduleGridWrapper">
                                    <table class="schedule-grid employee-grid" id="scheduleGrid">
                                        <thead>
                                            <tr>
                                                <th class="time-col">Time</th>
                                                <!-- Day columns rebuilt by JS with dates -->
                                            </tr>
                                        </thead>
                                        <tbody id="scheduleGridBody">
                                            <!-- Populated by JS -->
                                        </tbody>
                                    </table>
                                    <div id="scheduleEvents" class="schedule-events">
                                        <!-- Shift blocks positioned here -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Table View (Simple table like manager view) -->
                            <div class="schedule-view schedule-view-table" id="scheduleViewTable">
                                <div class="simple-table-wrapper">
                                    <table class="simple-schedule-table" id="simpleScheduleTable">
                                        <thead>
                                            <tr>
                                                <th class="name-col">Name</th>
                                                <!-- Day columns rebuilt by JS with dates -->
                                                <th class="hours-col">Hours</th>
                                            </tr>
                                        </thead>
                                        <tbody id="simpleScheduleBody">
                                            <!-- Populated by JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- Schedule Legend -->
                            <div class="schedule-legend-wrapper" id="scheduleLegendWrapper">
                                <div class="legend-title">Roles</div>
                                <div class="schedule-legend" id="scheduleLegend">
                                    {% for role in roles %}
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: {{ role.color }}"></span>
                                        <span class="legend-label">{{ role.name }}</span>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Hours Summary -->
                <div class="panel-card employee-hours-summary">
                    <h3 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        My Hours This Week
                    </h3>
                    <div class="hours-summary-content">
                        <div class="hours-stat">
                            <span class="hours-value" id="myScheduledHours">—</span>
                            <span class="hours-label">Scheduled Hours</span>
                        </div>
                        <div class="hours-stat">
                            <span class="hours-value" id="myShiftCount">—</span>
                            <span class="hours-label">Shifts</span>
                        </div>
                        <div class="hours-stat">
                            <span class="hours-value secondary" id="myHoursRange">{{ employee.min_hours }}-{{ employee.max_hours }}</span>
                            <span class="hours-label">Target Range</span>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Shifts -->
                <div class="panel-card upcoming-shifts-card">
                    <h3 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Upcoming Shifts
                    </h3>
                    <div class="upcoming-shifts-list" id="upcomingShiftsList">
                        <!-- Populated by JS -->
                        <p class="no-shifts-message" id="noShiftsMessage">No upcoming shifts scheduled</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Pass data to JavaScript -->
    <script>
        const EMPLOYEE_DATA = {
            business: {{ business_data|tojson|safe }},
            employee: {{ employee_data|tojson|safe }},
            allEmployees: {{ all_employees_data|tojson|safe }},
            roles: {{ roles_data|tojson|safe }},
            days: {{ days|tojson|safe }},
            daysOpen: {{ days_open|tojson|safe }},
            hours: {{ hours|tojson|safe }},
            startHour: {{ start_hour|tojson|safe }},
            endHour: {{ end_hour|tojson|safe }},
            schedule: {{ schedule_data|tojson|safe }},
            businessSlug: {{ business_slug|tojson|safe }}
        };
    </script>
    <script src="{{ url_for('static', filename='employee.js') }}"></script>
</body>
</html>

