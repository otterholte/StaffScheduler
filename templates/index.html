<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Scheduler Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body{% if is_demo %} class="demo-mode"{% endif %}>
    {% if is_demo %}
    <!-- Demo Mode Banner -->
    <div class="demo-banner">
        <div class="demo-banner-content">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <span>Demo Mode - <a href="#" id="demoBannerSignIn">Sign in</a> to save your data</span>
        </div>
    </div>
    {% endif %}
    
    <!-- Toast Notifications Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Main App Container -->
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <a href="/" class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span class="logo-text">Staff Scheduler</span>
                </a>
                <div class="business-selector" id="globalBusinessSelector">
                    <button class="business-btn" id="businessSelectorBtn">
                        <svg class="business-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <span class="business-name" id="currentBusinessName">{{ business.name }}</span>
                        <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="business-dropdown" id="businessDropdown">
                        {% if user_businesses_count > 0 %}
                        <div class="dropdown-header">Your Locations</div>
                        {% for b in businesses[:user_businesses_count] %}
                        <button class="business-option {% if b.id == business.id %}active{% endif %}" data-business-id="{{ b.id }}" data-business-slug="{{ b.slug }}">
                            <div class="option-icon {% if not b.emoji %}text-icon{% endif %}" style="background: {{ b.color }}">
                                {% if b.emoji %}{{ b.emoji }}{% else %}{{ b.name[0]|upper }}{% endif %}
                            </div>
                            <div class="option-details">
                                <span class="option-name">{{ b.name }}</span>
                                <span class="option-meta">{{ b.total_employees }} staff Â· {{ b.total_roles }} roles</span>
                            </div>
                            {% if b.id == business.id %}
                            <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            {% endif %}
                        </button>
                        {% endfor %}
                        <div class="dropdown-divider"></div>
                        {% endif %}
                        <div class="dropdown-header dropdown-header-demo">Demo Locations</div>
                        {% for b in businesses[user_businesses_count:] %}
                        <button class="business-option {% if b.id == business.id %}active{% endif %}" data-business-id="{{ b.id }}" data-business-slug="{{ b.slug }}">
                            <div class="option-icon {% if not b.emoji %}text-icon{% endif %}" style="background: {{ b.color }}">
                                {% if b.emoji %}{{ b.emoji }}{% else %}{{ b.name[0]|upper }}{% endif %}
                            </div>
                            <div class="option-details">
                                <span class="option-name">{{ b.name }}</span>
                                <span class="option-meta">{{ b.total_employees }} staff Â· {{ b.total_roles }} roles</span>
                            </div>
                            {% if b.id == business.id %}
                            <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            {% endif %}
                        </button>
                        {% endfor %}
                        <div class="dropdown-divider"></div>
                        <button class="add-business-btn" id="addBusinessBtn">
                            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="16"></line>
                                <line x1="8" y1="12" x2="16" y2="12"></line>
                            </svg>
                            Add New Location
                        </button>
                    </div>
                </div>
            </div>
            <div class="header-center">
                <nav class="main-nav">
                    <button class="nav-tab active" data-tab="schedule">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <span class="tab-text">Schedule</span>
                    </button>
                    <button class="nav-tab" data-tab="employees">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <span class="tab-text">Staff</span>
                    </button>
                    <button class="nav-tab" data-tab="settings">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path>
                        </svg>
                        <span class="tab-text">Availability</span>
                    </button>
                    <button class="nav-tab" data-tab="help">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        <span class="tab-text">Requirements</span>
                    </button>
                </nav>
            </div>
            <div class="header-right">
                <!-- PTO Notifications Bell -->
                <div class="pto-notification-wrapper" id="ptoNotificationWrapper">
                    <button class="pto-notification-bell" id="ptoNotificationBell" title="Time Off Requests">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span class="pto-notification-badge" id="ptoNotificationBadge"></span>
                    </button>
                    
                    <!-- PTO Dropdown -->
                    <div class="pto-notification-dropdown" id="ptoNotificationDropdown">
                        <div class="pto-notification-header">
                            <span>Pending Time Off Requests</span>
                        </div>
                        <div class="pto-notification-list" id="ptoNotificationList">
                            <!-- Populated by JS -->
                            <div class="pto-loading">Loading...</div>
                        </div>
                    </div>
                </div>
                
                <a href="/settings" class="icon-btn" title="Settings / Account">
                    <svg class="settings-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </a>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="app-main">
            <!-- ==================== SCHEDULE TAB ==================== -->
            <section id="tab-schedule" class="tab-content active">
                <div class="tab-header">
                    <div class="tab-header-left">
                        <h1>Weekly Schedule</h1>
                    </div>
                    <div class="tab-header-right">
                        <button id="generateBtn" class="btn btn-primary" title="Create an optimal schedule based on your employees and settings">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                            </svg>
                            Generate Schedule
                        </button>
                        <button id="alternativeBtn" class="btn btn-secondary" disabled title="Find a different schedule option that also works well">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <polyline points="1 20 1 14 7 14"></polyline>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                            </svg>
                            Find Alternative
                        </button>
                        <button id="resetBtn" class="btn btn-ghost" title="Clear the current schedule and start over">
                            <span class="btn-icon">â†º</span>
                            Reset
                        </button>
                    </div>
                </div>

                <!-- Who's Off This Week Card -->
                <div class="time-off-card" id="timeOffCard">
                    <div class="time-off-card-header" id="timeOffCardHeader">
                        <div class="time-off-card-title">
                            <span class="time-off-icon" id="timeOffIcon">ðŸŒ´</span>
                            <span class="time-off-title-text" id="timeOffTitleText">Time Off This Week</span>
                            <span class="time-off-count" id="timeOffCount"></span>
                        </div>
                        <button class="time-off-toggle" id="timeOffToggle" title="Toggle details">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div class="time-off-card-body" id="timeOffCardBody">
                        <div class="time-off-staff-list" id="timeOffStaffList">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div class="time-off-hint" id="timeOffHint">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                <line x1="1" y1="1" x2="23" y2="23" stroke-width="2.5"></line>
                            </svg>
                            <span>Do not contact for coverage</span>
                        </div>
                    </div>
                </div>

                <div class="schedule-layout">
                    <!-- Schedule Grid -->
                    <div class="schedule-panel">
                        <div class="panel-card">
                            <div class="schedule-toolbar">
                                <div class="toolbar-left">
                                    <!-- View Toggle -->
                                    <div class="view-toggle" id="viewToggle">
                                        <button class="view-toggle-btn active" data-view="timeline" title="Timeline View - Days as rows">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="3" y1="6" x2="21" y2="6"></line>
                                                <line x1="3" y1="12" x2="21" y2="12"></line>
                                                <line x1="3" y1="18" x2="21" y2="18"></line>
                                                <rect x="5" y="4" width="4" height="4" rx="1"></rect>
                                                <rect x="11" y="10" width="6" height="4" rx="1"></rect>
                                                <rect x="7" y="16" width="5" height="4" rx="1"></rect>
                                            </svg>
                                            Timeline
                                        </button>
                                        <button class="view-toggle-btn" data-view="grid" title="Hourly Grid View">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="3" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="3" width="7" height="7"></rect>
                                                <rect x="3" y="14" width="7" height="7"></rect>
                                                <rect x="14" y="14" width="7" height="7"></rect>
                                            </svg>
                                            Grid
                                        </button>
                                        <button class="view-toggle-btn" data-view="table" title="Simple Table View">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                            </svg>
                                            Table
                                        </button>
                                    </div>
                                </div>
                                <div class="toolbar-center">
                                    <!-- Week Navigation - Centered -->
                                    <div class="week-nav-inline" id="weekNavigationBar">
                                        <button class="week-nav-arrow" id="weekNavPrev" title="Previous week">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="15 18 9 12 15 6"></polyline>
                                            </svg>
                                        </button>
                                        <span class="week-date-range" id="weekDateRange">Dec 29 - Jan 4, 2025</span>
                                        <button class="week-nav-arrow" id="weekNavNext" title="Next week">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="9 18 15 12 9 6"></polyline>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="toolbar-right">
                                    <!-- Color Mode Toggle (icons only) -->
                                    <div class="color-mode-toggle color-mode-icons" id="colorModeToggle">
                                        <button class="color-mode-btn active" data-mode="role" title="Color by Role">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                                            </svg>
                                        </button>
                                        <button class="color-mode-btn" data-mode="employee" title="Color by Person">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                        </button>
                                    </div>
                                    <button id="exportBtn" class="btn-icon-only" title="Export schedule" disabled>
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="17 8 12 3 7 8"></polyline>
                                            <line x1="12" y1="3" x2="12" y2="15"></line>
                                        </svg>
                                    </button>
                                </div>
                                <!-- Status Badge Row -->
                                <div class="toolbar-badge-row" id="toolbarBadgeRow">
                                    <span class="week-status-badge" id="weekStatusBadge"></span>
                                </div>
                            </div>
                            
                            <!-- Grid View -->
                            <div class="schedule-view schedule-view-grid" id="scheduleViewGrid">
                                <div class="schedule-grid-wrapper" id="scheduleGridWrapper">
                                    <table class="schedule-grid" id="scheduleGrid">
                                        <thead>
                                            <tr>
                                                <th class="time-col">Time</th>
                                                {% for day_idx in days_open %}
                                                <th class="day-col {% if day_idx % 2 == 0 %}day-even{% else %}day-odd{% endif %}">{{ days[day_idx][:3] }}</th>
                                                {% endfor %}
                                            </tr>
                                        </thead>
                                        <tbody id="scheduleBody">
                                        {% for hour in hours %}
                                        <tr>
                                            <td class="time-cell">{% if hour == 0 or hour == 12 %}12{% elif hour < 12 %}{{ hour }}{% else %}{{ hour - 12 }}{% endif %}{% if hour < 12 %}am{% else %}pm{% endif %}</td>
                                                {% for day_idx in days_open %}
                                                <td class="slot {% if day_idx % 2 == 0 %}day-even{% else %}day-odd{% endif %}" data-day="{{ day_idx }}" data-hour="{{ hour }}">
                                                    <div class="slot-content"></div>
                                                </td>
                                                {% endfor %}
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    <!-- Shift blocks overlay -->
                                    <div class="schedule-events" id="scheduleEvents"></div>
                                </div>
                            </div>

                            <!-- Timeline View (Days as rows, Hours as columns) -->
                            <div class="schedule-view schedule-view-timeline active" id="scheduleViewTimeline">
                                <div class="timeline-wrapper" id="timelineWrapper">
                                    <div class="timeline-grid" id="timelineGrid">
                                        <!-- Will be populated by JS -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Table View -->
                            <div class="schedule-view schedule-view-table" id="scheduleViewTable">
                                <table class="simple-schedule-table" id="simpleScheduleTable">
                                    <thead>
                                        <tr>
                                            <th class="name-col">Name</th>
                                            <th class="day-even">Mon</th>
                                            <th class="day-odd">Tue</th>
                                            <th class="day-even">Wed</th>
                                            <th class="day-odd">Thu</th>
                                            <th class="day-even">Fri</th>
                                            <th class="day-odd">Sat</th>
                                            <th class="day-even">Sun</th>
                                            <th class="hours-col">Hours</th>
                                        </tr>
                                    </thead>
                                    <tbody id="simpleScheduleBody">
                                        <!-- Will be populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Schedule Legend -->
                            <div class="schedule-legend-wrapper" id="scheduleLegendWrapper">
                                <div class="legend-title" id="legendTitle">Roles</div>
                                <div class="schedule-legend" id="scheduleLegend">
                                    <!-- Legend items populated by JS -->
                                </div>
                            </div>
                            
                            <!-- Schedule Footer with Coverage Status + Publish -->
                            <div class="schedule-footer" id="scheduleFooter">
                                <div class="footer-spacer"></div>
                                <div class="footer-actions">
                                    <span id="scheduleStatusFooter" class="status-badge footer-status">Ready to generate</span>
                                    <button id="publishBtn" class="btn btn-primary btn-publish" disabled>
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M22 2L11 13"></path>
                                            <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
                                        </svg>
                                        Publish
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Schedule Metrics (Full Width Below) -->
                <div class="panel-card metrics-card metrics-fullwidth">
                    <h3 class="card-title">
                        <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        Schedule Metrics
                    </h3>
                    <div class="metrics-grid metrics-grid-horizontal">
                        <div class="metric" data-tooltip="Percentage of required shifts that are filled">
                            <span class="metric-value" id="coveragePercent">â€”%</span>
                            <span class="metric-label">Coverage</span>
                        </div>
                        <div class="metric" data-tooltip="Number of shift slots filled out of total required">
                            <span class="metric-value" id="slotsFilled">â€”/â€”</span>
                            <span class="metric-label">Slots Filled</span>
                        </div>
                        <div class="metric highlight" data-tooltip="Hours that still need to be covered - aim for zero!">
                            <span class="metric-value" id="hoursStillNeeded">â€”</span>
                            <span class="metric-label">Hours Needed</span>
                        </div>
                        <div class="metric" data-tooltip="Estimated total labor cost for this schedule">
                            <span class="metric-value" id="laborCost">$â€”</span>
                            <span class="metric-label">Labor Cost</span>
                        </div>
                        <div class="metric" data-tooltip="How long the computer took to create this schedule">
                            <span class="metric-value small" id="solveTime">â€”s</span>
                            <span class="metric-label">Solve Time</span>
                        </div>
                        <div class="metric" data-tooltip="Total overtime hours in this schedule">
                            <span class="metric-value small" id="overtimeHours">â€”</span>
                            <span class="metric-label">Overtime</span>
                        </div>
                    </div>
                </div>

                <!-- Coverage Gaps Card (Collapsible) -->
                <div class="panel-card gaps-card collapsible-card gaps-fullwidth" id="gapsCard" style="display: none;">
                    <h3 class="card-title danger collapsible-header" data-target="gapsContent">
                        <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        Coverage Gaps
                        <svg class="collapse-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </h3>
                    <div id="gapsContent" class="collapsible-content">
                        <div id="gapsByRole" class="gaps-section">
                            <div class="gaps-label">By Role:</div>
                            <div id="roleGaps"></div>
                        </div>
                        <div id="gapsByDay" class="gaps-section">
                            <div class="gaps-label">By Day:</div>
                            <div id="dayGaps"></div>
                        </div>
                    </div>
                </div>

                <!-- Employee Hours (Full Width Below) -->
                <div class="panel-card employee-hours-card collapsible-card employee-hours-fullwidth">
                    <h3 class="card-title collapsible-header" data-target="employeeHoursContent">
                        <svg class="card-title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Employee Hours
                        <svg class="collapse-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </h3>
                    <div id="employeeHoursContent" class="collapsible-content">
                        <div id="employeeHoursList" class="employee-hours-list employee-hours-grid">
                            {% for emp in employees %}
                            <div class="emp-hours-row" data-id="{{ emp.id }}">
                                <div class="emp-hours-info">
                                    <span class="emp-color-dot" style="background: {{ emp.color }}" data-tooltip="{{ emp.name }}"></span>
                                    <span class="emp-name" data-tooltip="{{ emp.name }}">{{ emp.name }}</span>
                                    <div class="emp-badges">
                                        {% if emp.classification == 'full_time' %}
                                        <span class="badge badge-ft"><span class="badge-short">FT</span><span class="badge-full">Full-Time</span></span>
                                        {% else %}
                                        <span class="badge badge-pt"><span class="badge-short">PT</span><span class="badge-full">Part-Time</span></span>
                                        {% endif %}
                                        {% if emp.needs_supervision %}
                                        <span class="badge badge-new"><span class="badge-short">NEW</span><span class="badge-full">New Hire</span></span>
                                        {% endif %}
                                        {% if emp.can_supervise %}
                                        <span class="badge badge-sup"><span class="badge-short">SUP</span><span class="badge-full">Supervisor</span></span>
                                        {% endif %}
                                        {% if emp.overtime_allowed %}
                                        <span class="badge badge-ot"><span class="badge-short">OT</span><span class="badge-full">Overtime</span></span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="emp-hours-stats">
                                    <span class="emp-hours" data-tooltip="Hours scheduled this week">â€”h</span>
                                    <span class="emp-range" data-tooltip="Required hours range (min-max)">({{ emp.min_hours }}-{{ emp.max_hours }})</span>
                                    <span class="emp-status" data-tooltip="Schedule status">â€”</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== EMPLOYEES TAB ==================== -->
            <section id="tab-employees" class="tab-content">
                <div class="tab-header">
                    <div class="tab-header-left">
                        <h1>Team Members</h1>
                        <span class="count-badge" id="employeeCount">{{ employees|length }} employees</span>
                    </div>
                    <div class="tab-header-right">
                        <div class="search-box">
                            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                            <input type="text" id="employeeSearch" placeholder="Search employees...">
                        </div>
                        <div class="filter-dropdown" id="employeeFilterDropdown">
                            <button class="filter-btn" id="employeeFilterBtn" data-tooltip="Filter employees">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                                </svg>
                                <span class="filter-label" id="filterLabel">All</span>
                                <svg class="filter-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="filter-menu" id="employeeFilterMenu">
                                <div class="filter-menu-section">Filter by</div>
                                <button class="filter-option active" data-filter="all">All Employees</button>
                                <button class="filter-option" data-filter="full_time">Full-Time Only</button>
                                <button class="filter-option" data-filter="part_time">Part-Time Only</button>
                                <button class="filter-option" data-filter="supervisors">Supervisors</button>
                                <button class="filter-option" data-filter="new_hires">New Hires</button>
                                <div class="filter-menu-section">By Role</div>
                                <div id="roleFilterOptions"></div>
                            </div>
                        </div>
                        <button id="addEmployeeBtn" class="btn btn-primary">
                            <span class="btn-icon">+</span>
                            Add Employee
                        </button>
                    </div>
                </div>

                <div class="employees-grid" id="employeesGrid">
                    <!-- Employee cards will be dynamically generated -->
                </div>
            </section>

            <!-- ==================== AVAILABILITY TAB ==================== -->
            <section id="tab-settings" class="tab-content">
                <div class="tab-header">
                    <div class="tab-header-left">
                        <h1>Availability</h1>
                        <p class="tab-subtitle">Set when each team member can work</p>
                    </div>
                </div>

                <div class="availability-layout">
                    <!-- Left sidebar: Staff list -->
                    <div class="availability-sidebar">
                        <h3 class="sidebar-title">Select Staff</h3>
                        
                        <!-- Search and Filter Controls -->
                        <div class="availability-filters">
                            <div class="avail-search-wrapper">
                                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                <input type="text" id="availabilitySearch" class="avail-search-input" placeholder="Search by name...">
                            </div>
                            <div class="avail-filter-row">
                                <div class="avail-role-filter">
                                    <select id="availabilityRoleFilter" class="avail-role-select">
                                        <option value="">All Roles</option>
                                        <!-- Roles populated dynamically -->
                                    </select>
                                </div>
                                <div class="avail-type-filter">
                                    <select id="availabilityTypeFilter" class="avail-type-select">
                                        <option value="">All Staff</option>
                                        <option value="full_time">Full Time</option>
                                        <option value="part_time">Part Time</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="availability-staff-list" id="availabilityStaffList">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <!-- Right panel: Availability grid -->
                    <div class="availability-panel" id="availabilityPanel">
                        <div class="availability-panel-empty" id="availabilityPanelEmpty">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="48" height="48">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <p>Select a staff member to view and edit their availability</p>
                        </div>
                        <div class="availability-panel-content" id="availabilityPanelContent" style="display: none;">
                            <div class="availability-panel-header">
                                <div class="availability-emp-info">
                                    <div class="availability-emp-avatar" id="availPanelAvatar">M</div>
                                    <div class="availability-emp-details">
                                        <h2 id="availPanelName">Employee Name</h2>
                                        <p id="availPanelHours">0 hours/week available</p>
                                    </div>
                                </div>
                            </div>
                            <div class="availability-presets">
                                <button class="preset-btn" data-preset="all-9-5">Mon-Sun 9-5</button>
                                <button class="preset-btn" data-preset="weekdays-9-5">Weekdays 9-5</button>
                                <button class="preset-btn" data-preset="weekends-9-5">Weekends 9-5</button>
                                <button class="preset-btn preset-danger" data-preset="clear">Clear All</button>
                            </div>
                            <div class="availability-grid-container">
                                <table class="availability-table" id="availabilityTable">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Sun</th>
                                            <th>Mon</th>
                                            <th>Tue</th>
                                            <th>Wed</th>
                                            <th>Thu</th>
                                            <th>Fri</th>
                                            <th>Sat</th>
                                        </tr>
                                    </thead>
                                    <tbody id="availabilityTableBody">
                                        <!-- Dynamically generated -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="availability-legend-bar">
                                <span class="legend-hint">Click and drag to select available times</span>
                                <div class="legend-items">
                                    <span class="legend-item"><span class="legend-dot available"></span> Available</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== REQUIREMENTS TAB ==================== -->
            <section id="tab-help" class="tab-content">
                <div class="tab-header">
                    <div class="tab-header-left">
                        <h1>Requirements</h1>
                        <p class="tab-subtitle">Define locations, qualifications, and shift coverage needs</p>
                    </div>
                </div>

                <!-- Sub-tabs for Requirements -->
                <div class="sub-tabs-container">
                    <div class="sub-tabs" id="requirementsSubTabs">
                        <button class="sub-tab active" data-subtab="shifts">Shift Requirements</button>
                        <button class="sub-tab" data-subtab="roles">Roles</button>
                        <button class="sub-tab" data-subtab="advanced">Advanced</button>
                    </div>
                </div>

                <!-- Sub-tab Content Panels -->
                <div class="sub-tab-content active" id="subtab-shifts">
                    <!-- Weekly Staffing Schedule -->
                    <div class="calendar-section coverage-section" id="shiftsSection">
                        <div class="calendar-header">
                            <div class="calendar-title">
                                <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                <h3>Weekly Staffing Schedule</h3>
                            </div>
                            <div class="calendar-header-actions">
                                <button class="icon-btn time-toggle-btn" id="timeRangeToggle" title="Business Hours">
                                    <svg class="btn-svg-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    <span class="time-toggle-label" id="timeToggleLabel">Business</span>
                                </button>
                                <button class="btn btn-primary btn-sm" id="addShiftBtn" title="Add new shift">
                                    <span class="btn-icon">+</span>
                                    Add Shift
                                </button>
                            </div>
                        </div>
                        
                        <div class="calendar-instructions calendar-instructions-top">
                            <span class="instruction-item"><strong>Drag</strong> to create shifts</span>
                            <span class="instruction-item"><strong>Click</strong> to edit</span>
                            <span class="instruction-item"><strong>Right-click</strong> to delete</span>
                        </div>
                        
                        <div class="calendar-wrapper">
                            <div class="calendar-container" id="calendarContainer">
                                <div class="calendar-grid" id="calendarGrid">
                                    <!-- Grid will be built by JS -->
                                </div>
                                
                                <!-- Shift events overlay -->
                                <div class="calendar-events" id="calendarEvents">
                                    <!-- Shift bars will be rendered here -->
                                </div>
                                
                                <!-- Drag selection overlay -->
                                <div class="calendar-selection" id="calendarSelection" style="display: none;"></div>
                            </div>
                        </div>
                        
                        <div class="calendar-legend-wrapper" id="legendWrapper">
                            <div class="legend-label">Roles:</div>
                            <div class="calendar-legend" id="calendarLegend">
                                <!-- Role colors will be shown here -->
                            </div>
                            <button class="legend-expand-btn" id="legendExpandBtn" style="display: none;">
                                <span class="expand-text">Show more</span>
                                <span class="expand-icon">â–¼</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Roles Sub-tab -->
                <div class="sub-tab-content" id="subtab-roles">
                    <div class="roles-panel">
                        <div class="roles-panel-header">
                            <div>
                                <h3>Roles & Positions</h3>
                                <p class="roles-description">Define the different positions in your business. Each role can have its own color for easy identification on the schedule.</p>
                            </div>
                            <button id="addRoleBtn" class="btn btn-primary">
                                <span>+</span> Add Role
                            </button>
                        </div>
                        <div class="roles-grid" id="rolesList">
                            {% for role in roles %}
                            <div class="role-card" data-id="{{ role.id }}">
                                <div class="role-card-color" style="background: {{ role.color }}"></div>
                                <div class="role-card-info">
                                    <span class="role-card-name">{{ role.name }}</span>
                                </div>
                                <div class="role-card-actions">
                                    <button class="btn-icon-sm edit-role-btn" title="Edit role">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                    </button>
                                    <button class="btn-icon-sm delete-role-btn" title="Remove role">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="3 6 5 6 21 6"></polyline>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="sub-tab-content" id="subtab-advanced">
                    <div class="advanced-panel">
                        <div class="advanced-panel-header">
                            <h3>Advanced Scheduling Rules</h3>
                            <p class="advanced-description">Fine-tune how the scheduler generates shifts for your team.</p>
                        </div>
                        
                        <!-- Scheduling Strategy Section -->
                        <div class="constraint-section">
                            <h4 class="constraint-section-title">Scheduling Strategy</h4>
                            <p class="constraint-description">Choose how the scheduler prioritizes when building shifts.</p>
                            
                            <div class="constraint-row strategy-row">
                                <div class="three-state-toggle wide-toggle" id="schedulingStrategyToggle">
                                    <button type="button" class="toggle-option" data-value="minimize">
                                        <span class="toggle-label">Minimize Cost</span>
                                        <span class="toggle-hint">Fewest hours for full coverage</span>
                                    </button>
                                    <button type="button" class="toggle-option active" data-value="balanced">
                                        <span class="toggle-label">Balanced</span>
                                        <span class="toggle-hint">Best overall schedule</span>
                                    </button>
                                    <button type="button" class="toggle-option" data-value="maximize">
                                        <span class="toggle-label">Maximize Hours</span>
                                        <span class="toggle-hint">More hours for all staff</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="rules-grid">
                            <div class="rule-item">
                                <label>Minimum shift length</label>
                                <select id="minShiftLength" class="small-select">
                                    <option value="1">1 hour</option>
                                    <option value="2" selected>2 hours</option>
                                    <option value="3">3 hours</option>
                                    <option value="4">4 hours</option>
                                    <option value="5">5 hours</option>
                                    <option value="6">6 hours</option>
                                    <option value="7">7 hours</option>
                                    <option value="8">8 hours</option>
                                </select>
                            </div>
                            <div class="rule-item">
                                <label>Max hours per day</label>
                                <select id="maxHoursPerDay" class="small-select">
                                    <option value="4">4 hours</option>
                                    <option value="6">6 hours</option>
                                    <option value="8" selected>8 hours</option>
                                    <option value="10">10 hours</option>
                                    <option value="12">12 hours</option>
                                </select>
                            </div>
                            <div class="rule-item">
                                <label>Max shifts per day</label>
                                <select id="maxSplits" class="small-select">
                                    <option value="1">1 shift only</option>
                                    <option value="2" selected>Up to 2 shifts</option>
                                </select>
                            </div>
                            <div class="rule-item">
                                <label>Max split shifts per week</label>
                                <select id="maxSplitShiftsPerWeek" class="small-select">
                                    <option value="0">No split shifts</option>
                                    <option value="1" selected>1 day</option>
                                    <option value="2">2 days</option>
                                    <option value="3">3 days</option>
                                    <option value="7">Unlimited</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Max Days Per Week Section -->
                        <div class="constraint-section">
                            <h4 class="constraint-section-title">Maximum Days Per Week</h4>
                            <p class="constraint-description">Limit how many days employees can be scheduled each week.</p>
                            
                            <div class="constraint-row" data-tooltip="Control maximum days per week for full-time employees">
                                <div class="constraint-label">
                                    <span class="constraint-name">Full-Time Employees</span>
                                    <span class="constraint-detail">Max <select id="maxDaysFT" class="inline-select">
                                        <option value="4">4</option>
                                        <option value="5" selected>5</option>
                                        <option value="6">6</option>
                                        <option value="7">7</option>
                                    </select> days/week</span>
                                </div>
                                <div class="three-state-toggle" id="maxDaysFTToggle">
                                    <button type="button" class="toggle-option" data-value="off">Off</button>
                                    <button type="button" class="toggle-option" data-value="preferred">Preferred</button>
                                    <button type="button" class="toggle-option active" data-value="required">Required</button>
                                </div>
                            </div>
                            
                            <div class="constraint-row" data-tooltip="Control maximum days per week for part-time employees">
                                <div class="constraint-label">
                                    <span class="constraint-name">Part-Time Employees</span>
                                    <span class="constraint-detail">Max <select id="maxDaysPT" class="inline-select">
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4" selected>4</option>
                                        <option value="5">5</option>
                                    </select> days/week</span>
                                </div>
                                <div class="three-state-toggle" id="maxDaysPTToggle">
                                    <button type="button" class="toggle-option" data-value="off">Off</button>
                                    <button type="button" class="toggle-option" data-value="preferred">Preferred</button>
                                    <button type="button" class="toggle-option active" data-value="required">Required</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="toggle-list">
                            <label class="toggle-row" data-tooltip="When enabled, employees marked as 'needs supervision' will only be scheduled when a supervisor is also working">
                                <input type="checkbox" id="supervisionRequired" checked>
                                <span class="toggle-switch"></span>
                                <span>New employees must work with a supervisor</span>
                            </label>
                            <label class="toggle-row" data-tooltip="The system will try to share Saturday and Sunday shifts evenly among all employees">
                                <input type="checkbox" id="weekendFairness" checked>
                                <span class="toggle-switch"></span>
                                <span>Try to distribute weekend shifts fairly</span>
                            </label>
                            <label class="toggle-row" data-tooltip="The system will try to keep employees under 40 hours to avoid overtime pay when possible">
                                <input type="checkbox" id="avoidOvertime" checked>
                                <span class="toggle-switch"></span>
                                <span>Avoid overtime when possible</span>
                            </label>
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <div class="footer-main">
                    <div class="footer-brand">
                        <div class="footer-logo">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            Staff Scheduler Pro
                        </div>
                        <p class="footer-tagline">Smart scheduling for modern teams.</p>
                    </div>
                    <div class="footer-links-inline">
                        <a href="/features">Features</a>
                        <a href="/pricing">Pricing</a>
                        <a href="/support">Support</a>
                        <a href="/contact">Contact</a>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p class="footer-copyright">Â© 2025 Staff Scheduler Pro. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- ==================== MODALS ==================== -->
    
    <!-- Add/Edit Employee Modal -->
    <div id="employeeModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="employeeModalTitle">Add Employee</h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <form id="employeeForm">
                    <input type="hidden" id="empId">
                    
                    <div class="form-section">
                        <h4>Basic Information</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="empName">Name *</label>
                                <input type="text" id="empName" required placeholder="John Smith">
                            </div>
                            <div class="form-group">
                                <label for="empColor">Color</label>
                                <input type="color" id="empColor" value="#4CAF50">
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="empEmail">Email</label>
                                <input type="email" id="empEmail" placeholder="employee@email.com">
                            </div>
                            <div class="form-group">
                                <label for="empPhone">Phone</label>
                                <input type="tel" id="empPhone" placeholder="(555) 123-4567">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section invite-section" id="inviteSection">
                        <h4>Portal Access</h4>
                        <p class="section-hint">Send an invitation so this employee can view their schedule and update availability.</p>
                        <div class="toggle-list compact">
                            <label class="toggle-row">
                                <input type="checkbox" id="empSendInvite">
                                <span class="toggle-switch"></span>
                                <span>Send portal invitation on save</span>
                            </label>
                        </div>
                        <div class="invite-options" id="inviteOptions" style="display: none;">
                            <div class="invite-method-group">
                                <label class="invite-method-option">
                                    <input type="checkbox" id="inviteByEmail" checked>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                        <polyline points="22,6 12,13 2,6"></polyline>
                                    </svg>
                                    <span>Email</span>
                                </label>
                                <label class="invite-method-option">
                                    <input type="checkbox" id="inviteBySMS">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                    <span>Text Message</span>
                                </label>
                            </div>
                            <p class="invite-note" id="inviteNote"></p>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Hours & Classification</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="empClassification">Type</label>
                                <select id="empClassification">
                                    <option value="part_time">Part-Time</option>
                                    <option value="full_time">Full-Time</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="empHourlyRate">Hourly Rate ($)</label>
                                <input type="number" id="empHourlyRate" value="15" min="0" step="0.50">
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="empMinHours">Min Hours/Week</label>
                                <input type="number" id="empMinHours" value="15" min="0" max="60">
                            </div>
                            <div class="form-group">
                                <label for="empMaxHours">Max Hours/Week</label>
                                <input type="number" id="empMaxHours" value="25" min="0" max="60">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Roles</h4>
                        <div class="roles-checkboxes" id="empRoles">
                            <!-- Dynamically populated -->
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Special Settings</h4>
                        <div class="toggle-list compact">
                            <label class="toggle-row" data-tooltip="Turn on if this employee can train and supervise new employees">
                                <input type="checkbox" id="empCanSupervise">
                                <span class="toggle-switch"></span>
                                <span>Can supervise others</span>
                            </label>
                            <label class="toggle-row" data-tooltip="Turn on for new employees who should always work alongside an experienced supervisor">
                                <input type="checkbox" id="empNeedsSupervision">
                                <span class="toggle-switch"></span>
                                <span>Needs supervision (new employee)</span>
                            </label>
                            <label class="toggle-row" data-tooltip="Turn on if this employee is allowed to work more than 40 hours per week">
                                <input type="checkbox" id="empOvertimeAllowed">
                                <span class="toggle-switch"></span>
                                <span>Overtime allowed</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" data-close>Cancel</button>
                <button type="submit" form="employeeForm" class="btn btn-primary" id="saveEmployeeBtn">Save Employee</button>
            </div>
        </div>
    </div>

    <!-- Availability Modal -->
    <div id="availabilityModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>Edit Availability: <span id="availEmpName">Employee</span></h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <div class="availability-legend">
                    <div class="legend-item">
                        <span class="legend-box unavailable"></span>
                        <span>Not Available</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-box available"></span>
                        <span>Available</span>
                    </div>
                </div>
                <p class="availability-instructions">Click and drag to select available times</p>
                <div class="availability-grid-wrapper">
                    <table class="availability-grid" id="availabilityGrid">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Mon</th>
                                <th>Tue</th>
                                <th>Wed</th>
                                <th>Thu</th>
                                <th>Fri</th>
                                <th>Sat</th>
                                <th>Sun</th>
                            </tr>
                        </thead>
                        <tbody id="availabilityBody">
                            <!-- Dynamically generated -->
                        </tbody>
                    </table>
                </div>
                <div class="availability-actions">
                    <button class="btn btn-sm btn-ghost" id="clearAvailability">Clear All</button>
                    <button class="btn btn-sm btn-ghost" id="fillWeekdays">Fill Weekdays</button>
                    <button class="btn btn-sm btn-ghost" id="fillAll">Fill All</button>
                </div>
                
                <!-- PTO Requests Section (Manager View) -->
                <div class="manager-pto-section" id="managerPTOSection">
                    <div class="pto-section-header">
                        <h4>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            Time Off Requests
                            <span class="pto-pending-badge" id="ptoPendingBadge" style="display: none;">0</span>
                        </h4>
                    </div>
                    <div class="manager-pto-list" id="managerPTOList">
                        <!-- Populated by JS -->
                        <div class="pto-loading">Loading requests...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" data-close>Cancel</button>
                <button type="button" class="btn btn-primary" id="saveAvailabilityBtn">Save Availability</button>
            </div>
        </div>
    </div>

    <!-- Role Modal -->
    <div id="roleModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2 id="roleModalTitle">Add Role</h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <form id="roleForm">
                    <input type="hidden" id="roleId">
                    <div class="form-group">
                        <label for="roleName">Role Name *</label>
                        <input type="text" id="roleName" required placeholder="e.g., Shift Lead">
                    </div>
                    <div class="form-group">
                        <label for="roleColor">Color</label>
                        <input type="color" id="roleColor" value="#6366f1">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" data-close>Cancel</button>
                <button type="submit" form="roleForm" class="btn btn-primary">Save Role</button>
            </div>
        </div>
    </div>

    <!-- Slot Edit Modal -->
    <div id="slotModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2>Edit Shift</h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <p class="slot-info" id="slotInfo">Monday 9:00 AM</p>
                <div class="form-group">
                    <label>Assign Employee:</label>
                    <select id="slotEmployee" class="full-width">
                        <option value="">â€” Unassigned â€”</option>
                        <!-- Dynamically populated -->
                    </select>
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="slotRole" class="full-width">
                        <!-- Dynamically populated -->
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" data-close>Cancel</button>
                <button type="button" class="btn btn-primary" id="saveSlotBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Confirm Dialog -->
    <div id="confirmModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2 id="confirmTitle">Confirm</h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" data-close>Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmBtn">Delete</button>
            </div>
        </div>
    </div>

    <!-- Shift Template Modal -->
    <div id="shiftModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="shiftModalTitle">Add Shift</h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <form id="shiftForm">
                    <input type="hidden" id="shiftId">
                    
                    <div class="form-section">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="shiftName">Shift Name *</label>
                                <input type="text" id="shiftName" required placeholder="e.g., Opening Shift">
                            </div>
                            <div class="form-group">
                                <label>Shift Color</label>
                                <div class="color-selector" id="shiftColorSelector">
                                    <div class="color-options" id="roleColorOptions">
                                        <!-- Role colors will be populated dynamically -->
                                    </div>
                                    <div class="color-custom">
                                        <input type="color" id="shiftColor" value="#6366f1">
                                        <span class="custom-label">Custom</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Time Range</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="shiftStartHour">Start Time</label>
                                <select id="shiftStartHour" class="time-select">
                                    <!-- Populated dynamically -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="shiftEndHour">End Time</label>
                                <select id="shiftEndHour" class="time-select">
                                    <!-- Populated dynamically -->
                                </select>
                            </div>
                        </div>
                        <div class="shift-duration" id="shiftDuration">Duration: 8 hours</div>
                    </div>

                    <div class="form-section">
                        <h4>Days This Shift Applies</h4>
                        <div class="days-checkboxes shift-days" id="shiftDays">
                            <label class="day-checkbox">
                                <input type="checkbox" value="0" checked>
                                <span>Mon</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="1" checked>
                                <span>Tue</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="2" checked>
                                <span>Wed</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="3" checked>
                                <span>Thu</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="4" checked>
                                <span>Fri</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="5" checked>
                                <span>Sat</span>
                            </label>
                            <label class="day-checkbox">
                                <input type="checkbox" value="6" checked>
                                <span>Sun</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Staff Required</h4>
                        <p class="section-description">Set minimum required and maximum allowed staff for each role</p>
                        <div class="shift-roles-editor" id="shiftRolesEditor">
                            <!-- Role requirements will be populated dynamically -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" data-close>Cancel</button>
                <button type="submit" form="shiftForm" class="btn btn-primary" id="saveShiftBtn">Save Shift</button>
            </div>
        </div>
    </div>


    <!-- Available Employees Modal (for coverage gaps) -->
    <div id="gapModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2 id="gapModalTitle">Coverage Gap</h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <div class="gap-modal-info" id="gapModalInfo">
                    <!-- Gap details will be populated -->
                </div>
                <h3 class="gap-modal-subtitle">Available Employees</h3>
                <div class="available-employees-list" id="availableEmployeesList">
                    <!-- Available employees will be populated -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" data-close>Close</button>
            </div>
        </div>
    </div>

    <!-- Shift Edit Modal (for reassigning/deleting shifts) -->
    <div id="shiftEditModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h2 id="shiftEditModalTitle">Edit Shift</h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <div class="shift-edit-info" id="shiftEditInfo">
                    <!-- Shift details will be populated -->
                </div>
                <div class="shift-edit-actions">
                    <div class="form-group">
                        <label>Reassign to:</label>
                        <select id="shiftEditEmployee" class="form-select">
                            <!-- Available employees will be populated -->
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="deleteShiftBtn">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Delete Shift
                </button>
                <button type="button" class="btn btn-ghost" data-close>Cancel</button>
                <button type="button" class="btn btn-primary" id="saveShiftEditBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Timeline Add Shift Modal -->
    <div id="timelineAddShiftModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h2 id="timelineAddShiftTitle">Add Shift</h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <form id="timelineAddShiftForm">
                    <input type="hidden" id="timelineAddShiftDay">
                    
                    <div class="form-section">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="timelineAddShiftEmployee">Employee *</label>
                                <select id="timelineAddShiftEmployee" class="form-select" required>
                                    <!-- Populated dynamically -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="timelineAddShiftRole">Role *</label>
                                <select id="timelineAddShiftRole" class="form-select" required>
                                    <!-- Populated dynamically -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Shift Time</h4>
                        <div class="form-grid time-picker-grid">
                            <div class="form-group">
                                <label for="timelineAddShiftStartHour">Start Time</label>
                                <div class="time-picker-row">
                                    <select id="timelineAddShiftStartHour" class="form-select time-select-hour">
                                        <!-- Hours populated dynamically -->
                                    </select>
                                    <span class="time-separator">:</span>
                                    <select id="timelineAddShiftStartMin" class="form-select time-select-min">
                                        <option value="0">00</option>
                                        <option value="15">15</option>
                                        <option value="30">30</option>
                                        <option value="45">45</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="timelineAddShiftEndHour">End Time</label>
                                <div class="time-picker-row">
                                    <select id="timelineAddShiftEndHour" class="form-select time-select-hour">
                                        <!-- Hours populated dynamically -->
                                    </select>
                                    <span class="time-separator">:</span>
                                    <select id="timelineAddShiftEndMin" class="form-select time-select-min">
                                        <option value="0">00</option>
                                        <option value="15">15</option>
                                        <option value="30">30</option>
                                        <option value="45">45</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="shift-duration-preview" id="timelineAddShiftDuration">Duration: 0 hours</div>
                    </div>

                    <div class="form-section employee-preview-section" id="timelineAddShiftPreview" style="display: none;">
                        <h4>Employee Info</h4>
                        <div class="employee-preview-info" id="timelineAddShiftEmpInfo">
                            <!-- Populated when employee selected -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" data-close>Cancel</button>
                <button type="submit" form="timelineAddShiftForm" class="btn btn-primary" id="timelineAddShiftSaveBtn">Add Shift</button>
            </div>
        </div>
    </div>

    <!-- Business Edit Modal -->
    <div id="businessModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2 id="businessModalTitle">Edit Location</h2>
                <button class="modal-close" data-close>&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="businessEditId">
                <div class="form-group">
                    <label for="businessEditEmoji">Icon</label>
                    <div class="emoji-picker-container">
                        <button type="button" class="emoji-picker-btn" id="businessEmojiBtn">
                            <span id="businessEditEmoji">ðŸ¢</span>
                        </button>
                        <div class="emoji-picker-backdrop" id="emojiPickerBackdrop"></div>
                        <div class="emoji-picker" id="emojiPicker">
                            <button type="button" class="emoji-picker-close" id="emojiPickerClose">&times;</button>
                            <div class="emoji-picker-header">Choose an icon</div>
                            <div class="emoji-search-container">
                                <svg class="emoji-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="M21 21l-4.35-4.35"></path>
                                </svg>
                                <input type="text" class="emoji-search-input" id="emojiSearch" placeholder="Search icons...">
                            </div>
                            <div class="emoji-category-select-container">
                                <label class="emoji-category-label">Category:</label>
                                <div class="emoji-category-dropdown" id="emojiCategoryDropdown">
                                    <button type="button" class="emoji-category-select" id="emojiCategorySelect">
                                        <span class="category-icon">â­</span>
                                        <span class="category-name">Favorites</span>
                                        <svg class="dropdown-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                    </button>
                                    <div class="emoji-category-options" id="emojiCategoryOptions">
                                        <button type="button" class="emoji-category-option active" data-category="favorites">
                                            <span class="option-icon">â­</span> Favorites
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="all">
                                            <span class="option-icon">ðŸ“‹</span> All Icons
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="buildings">
                                            <span class="option-icon">ðŸ¢</span> Buildings & Places
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="food">
                                            <span class="option-icon">â˜•</span> Food & Drink
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="business">
                                            <span class="option-icon">ðŸ’¼</span> Business & Work
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="retail">
                                            <span class="option-icon">ðŸ›’</span> Retail & Shopping
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="transport">
                                            <span class="option-icon">ðŸšš</span> Logistics & Transport
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="tools">
                                            <span class="option-icon">ðŸ”§</span> Services & Tools
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="entertainment">
                                            <span class="option-icon">ðŸŽ¬</span> Entertainment
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="nature">
                                            <span class="option-icon">ðŸŒ³</span> Nature & Outdoors
                                        </button>
                                        <button type="button" class="emoji-category-option" data-category="education">
                                            <span class="option-icon">ðŸ“š</span> Education
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="emoji-clear-btn" data-emoji="">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
                                </svg>
                                No icon
                            </button>
                            <div class="emoji-grid-container">
                            <div class="emoji-grid" id="emojiGrid">
                                <!-- Favorites - Most commonly used -->
                                <button type="button" class="emoji-option" data-emoji="ðŸ¢" data-category="favorites buildings" data-name="office building corporate">ðŸ¢</button>
                                <button type="button" class="emoji-option" data-emoji="â˜•" data-category="favorites food" data-name="coffee cafe hot drink">â˜•</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸª" data-category="favorites buildings" data-name="convenience store shop retail">ðŸª</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ½ï¸" data-category="favorites food" data-name="restaurant dining plate food">ðŸ½ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ’¼" data-category="favorites business" data-name="briefcase business work office">ðŸ’¼</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ“ž" data-category="favorites business" data-name="phone telephone call center">ðŸ“ž</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ­" data-category="favorites buildings" data-name="factory manufacturing industrial warehouse">ðŸ­</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ“¦" data-category="favorites transport" data-name="package box shipping delivery">ðŸ“¦</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ›’" data-category="favorites retail" data-name="shopping cart grocery store">ðŸ›’</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ¥" data-category="favorites buildings" data-name="hospital medical health clinic">ðŸ¥</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ’»" data-category="favorites business" data-name="laptop computer tech IT">ðŸ’»</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ”§" data-category="favorites tools" data-name="wrench repair maintenance fix">ðŸ”§</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸšš" data-category="favorites transport" data-name="truck delivery shipping logistics">ðŸšš</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ«" data-category="favorites buildings" data-name="school education learning">ðŸ«</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ¬" data-category="favorites entertainment" data-name="movie film cinema theater">ðŸŽ¬</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ‹ï¸" data-category="favorites entertainment" data-name="gym fitness weightlifting exercise">ðŸ‹ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="âœˆï¸" data-category="favorites transport" data-name="airplane flight travel airport">âœˆï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ¨" data-category="favorites buildings" data-name="hotel hospitality lodging">ðŸ¨</button>
                                <!-- Buildings & Places -->
                                <button type="button" class="emoji-option" data-emoji="ðŸ¢" data-category="buildings" data-name="office building corporate">ðŸ¢</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸª" data-category="buildings" data-name="convenience store shop retail">ðŸª</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ­" data-category="buildings" data-name="factory manufacturing industrial warehouse">ðŸ­</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ¥" data-category="buildings" data-name="hospital medical health clinic">ðŸ¥</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ«" data-category="buildings" data-name="school education learning">ðŸ«</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ¨" data-category="buildings" data-name="hotel hospitality lodging">ðŸ¨</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ¬" data-category="buildings" data-name="department store mall shopping">ðŸ¬</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ " data-category="buildings" data-name="house home residential">ðŸ </button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ—ï¸" data-category="buildings" data-name="construction building site">ðŸ—ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="â›ª" data-category="buildings" data-name="church religious chapel">â›ª</button>
                                <!-- Food & Drink -->
                                <button type="button" class="emoji-option" data-emoji="â˜•" data-category="food" data-name="coffee cafe hot drink">â˜•</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ½ï¸" data-category="food" data-name="restaurant dining plate food">ðŸ½ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ•" data-category="food" data-name="pizza italian food">ðŸ•</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ”" data-category="food" data-name="burger hamburger fast food">ðŸ”</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸœ" data-category="food" data-name="noodles ramen asian food">ðŸœ</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ¦" data-category="food" data-name="ice cream dessert sweet">ðŸ¦</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸº" data-category="food" data-name="beer bar pub drink">ðŸº</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ¥" data-category="food" data-name="croissant bakery pastry bread">ðŸ¥</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ³" data-category="food" data-name="cooking egg breakfast kitchen">ðŸ³</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ§" data-category="food" data-name="cupcake bakery dessert sweet">ðŸ§</button>
                                <!-- Business & Work -->
                                <button type="button" class="emoji-option" data-emoji="ðŸ’¼" data-category="business" data-name="briefcase business work office">ðŸ’¼</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ“ž" data-category="business" data-name="phone telephone call center">ðŸ“ž</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ’»" data-category="business" data-name="laptop computer tech IT">ðŸ’»</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ–¥ï¸" data-category="business" data-name="desktop computer monitor screen">ðŸ–¥ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ“Š" data-category="business" data-name="chart analytics data graph">ðŸ“Š</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ“ˆ" data-category="business" data-name="growth chart trending up sales">ðŸ“ˆ</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ’°" data-category="business" data-name="money bag finance wealth">ðŸ’°</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ¦" data-category="business" data-name="bank finance money">ðŸ¦</button>
                                <button type="button" class="emoji-option" data-emoji="âš–ï¸" data-category="business" data-name="scales justice law legal">âš–ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ“" data-category="business" data-name="memo notes writing document">ðŸ“</button>
                                <!-- Retail & Shopping -->
                                <button type="button" class="emoji-option" data-emoji="ðŸ›’" data-category="retail" data-name="shopping cart grocery store">ðŸ›’</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ›ï¸" data-category="retail" data-name="shopping bags retail fashion">ðŸ›ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ‘—" data-category="retail" data-name="dress fashion clothing apparel">ðŸ‘—</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ‘Ÿ" data-category="retail" data-name="sneaker shoes footwear athletic">ðŸ‘Ÿ</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ’„" data-category="retail" data-name="lipstick makeup cosmetics beauty">ðŸ’„</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ’Ž" data-category="retail" data-name="gem diamond jewelry luxury">ðŸ’Ž</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ" data-category="retail" data-name="gift present box wrapped">ðŸŽ</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ·ï¸" data-category="retail" data-name="label tag price sale">ðŸ·ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ“±" data-category="retail" data-name="phone mobile smartphone device">ðŸ“±</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ®" data-category="retail" data-name="game controller gaming video">ðŸŽ®</button>
                                <!-- Logistics & Transport -->
                                <button type="button" class="emoji-option" data-emoji="ðŸ“¦" data-category="transport" data-name="package box shipping delivery">ðŸ“¦</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸšš" data-category="transport" data-name="truck delivery shipping logistics">ðŸšš</button>
                                <button type="button" class="emoji-option" data-emoji="âœˆï¸" data-category="transport" data-name="airplane flight travel airport">âœˆï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸš¢" data-category="transport" data-name="ship boat cargo maritime">ðŸš¢</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸš—" data-category="transport" data-name="car auto vehicle driving">ðŸš—</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸšŒ" data-category="transport" data-name="bus transit public transport">ðŸšŒ</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸš‚" data-category="transport" data-name="train rail locomotive">ðŸš‚</button>
                                <button type="button" class="emoji-option" data-emoji="â›½" data-category="transport" data-name="gas fuel station pump">â›½</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ…¿ï¸" data-category="transport" data-name="parking lot garage">ðŸ…¿ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ›«" data-category="transport" data-name="departure takeoff airport flight">ðŸ›«</button>
                                <!-- Services & Tools -->
                                <button type="button" class="emoji-option" data-emoji="ðŸ”§" data-category="tools" data-name="wrench repair maintenance fix">ðŸ”§</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ”¨" data-category="tools" data-name="hammer construction build">ðŸ”¨</button>
                                <button type="button" class="emoji-option" data-emoji="âš™ï¸" data-category="tools" data-name="gear settings mechanical engineering">âš™ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ”Œ" data-category="tools" data-name="plug electric power outlet">ðŸ”Œ</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ’¡" data-category="tools" data-name="lightbulb idea bright electric">ðŸ’¡</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ§¹" data-category="tools" data-name="broom cleaning janitorial sweep">ðŸ§¹</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ§ª" data-category="tools" data-name="test tube lab science chemistry">ðŸ§ª</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ’Š" data-category="tools" data-name="pill medicine pharmacy drug">ðŸ’Š</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ©º" data-category="tools" data-name="stethoscope doctor medical health">ðŸ©º</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ”¬" data-category="tools" data-name="microscope science lab research">ðŸ”¬</button>
                                <!-- Entertainment & Leisure -->
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ¬" data-category="entertainment" data-name="movie film cinema theater">ðŸŽ¬</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽµ" data-category="entertainment" data-name="music note song audio">ðŸŽµ</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ¨" data-category="entertainment" data-name="art palette painting creative">ðŸŽ¨</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ­" data-category="entertainment" data-name="theater drama performing arts mask">ðŸŽ­</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽª" data-category="entertainment" data-name="circus tent carnival fair">ðŸŽª</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ°" data-category="entertainment" data-name="slot machine casino gambling">ðŸŽ°</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ³" data-category="entertainment" data-name="bowling ball pins alley">ðŸŽ³</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ‹ï¸" data-category="entertainment" data-name="gym fitness weightlifting exercise">ðŸ‹ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="âš½" data-category="entertainment" data-name="soccer football sports ball">âš½</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ¯" data-category="entertainment" data-name="target bullseye darts goal">ðŸŽ¯</button>
                                <!-- Nature & Outdoors -->
                                <button type="button" class="emoji-option" data-emoji="ðŸŒ³" data-category="nature" data-name="tree nature forest park">ðŸŒ³</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŒ»" data-category="nature" data-name="sunflower garden flower plant">ðŸŒ»</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŒŠ" data-category="nature" data-name="wave ocean sea water beach">ðŸŒŠ</button>
                                <button type="button" class="emoji-option" data-emoji="â›°ï¸" data-category="nature" data-name="mountain hiking outdoor adventure">â›°ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ–ï¸" data-category="nature" data-name="beach umbrella vacation resort">ðŸ–ï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ¾" data-category="nature" data-name="paw prints pet animal">ðŸ¾</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ•" data-category="nature" data-name="dog pet animal canine">ðŸ•</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŒ¾" data-category="nature" data-name="wheat grain farm agriculture">ðŸŒ¾</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸšœ" data-category="nature" data-name="tractor farm agriculture vehicle">ðŸšœ</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŒ¿" data-category="nature" data-name="herb plant leaf green organic">ðŸŒ¿</button>
                                <!-- Education & Learning -->
                                <button type="button" class="emoji-option" data-emoji="ðŸ“š" data-category="education" data-name="books library reading study">ðŸ“š</button>
                                <button type="button" class="emoji-option" data-emoji="âœï¸" data-category="education" data-name="pencil writing school draw">âœï¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ“" data-category="education" data-name="graduation cap education university college">ðŸŽ“</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ“–" data-category="education" data-name="book reading open page">ðŸ“–</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ”­" data-category="education" data-name="telescope astronomy science space">ðŸ”­</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ¹" data-category="education" data-name="piano keyboard music instrument">ðŸŽ¹</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸŽ¸" data-category="education" data-name="guitar music instrument rock">ðŸŽ¸</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ“·" data-category="education" data-name="camera photo photography picture">ðŸ“·</button>
                                <button type="button" class="emoji-option" data-emoji="ðŸ–Œï¸" data-category="education" data-name="paintbrush art creative painting">ðŸ–Œï¸</button>
                                <button type="button" class="emoji-option" data-emoji="âœ‚ï¸" data-category="education" data-name="scissors cut craft salon">âœ‚ï¸</button>
                            </div>
                            </div>
                            <div class="emoji-no-results" id="emojiNoResults" style="display: none;">
                                No icons found
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="businessEditName">Location Name</label>
                    <input type="text" id="businessEditName" class="form-input" placeholder="e.g., Downtown Office">
                </div>
                <div class="form-group">
                    <label for="businessEditColor">Theme Color</label>
                    <div class="color-picker-row">
                        <input type="color" id="businessEditColor" class="color-input" value="#6366f1">
                        <div class="color-presets">
                            <button type="button" class="color-preset" data-color="#06d6a0" style="background: #06d6a0"></button>
                            <button type="button" class="color-preset" data-color="#6366f1" style="background: #6366f1"></button>
                            <button type="button" class="color-preset" data-color="#f59e0b" style="background: #f59e0b"></button>
                            <button type="button" class="color-preset" data-color="#3b82f6" style="background: #3b82f6"></button>
                            <button type="button" class="color-preset" data-color="#8b5cf6" style="background: #8b5cf6"></button>
                            <button type="button" class="color-preset" data-color="#ec4899" style="background: #ec4899"></button>
                            <button type="button" class="color-preset" data-color="#ef4444" style="background: #ef4444"></button>
                            <button type="button" class="color-preset" data-color="#14b8a6" style="background: #14b8a6"></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="delete-btn-wrapper" id="deleteBusinessWrapper">
                    <button type="button" class="btn btn-danger" id="deleteBusinessBtn" disabled>
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Delete
                    </button>
                    <span class="delete-hint" id="deleteHint">Sample locations cannot be deleted</span>
                </div>
                <button type="button" class="btn btn-ghost" data-close>Cancel</button>
                <button type="button" class="btn btn-primary" id="saveBusinessBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Login Modal (for non-authenticated users) -->
    <div id="accountModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2 id="accountModalTitle">Sign In</h2>
                <button class="modal-close" data-close>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">Login</button>
                    <button class="auth-tab" data-tab="signup">Create Account</button>
                </div>
                
                <!-- Login Form -->
                <form id="accountLoginForm" class="auth-form active">
                    <div class="form-group">
                        <label for="accountLoginEmail">Email</label>
                        <input type="email" id="accountLoginEmail" placeholder="Enter your email" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="accountLoginPassword">Password</label>
                        <input type="password" id="accountLoginPassword" placeholder="Enter your password" autocomplete="current-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                            <polyline points="10 17 15 12 10 7"></polyline>
                            <line x1="15" y1="12" x2="3" y2="12"></line>
                        </svg>
                        Login
                    </button>
                </form>
                
                <!-- Signup Form -->
                <form id="accountSignupForm" class="auth-form">
                    <div class="form-group">
                        <label for="accountSignupEmail">Email</label>
                        <input type="email" id="accountSignupEmail" placeholder="Enter your email" autocomplete="email" required>
                    </div>
                    <div class="form-group">
                        <label for="accountSignupUsername">Username</label>
                        <input type="text" id="accountSignupUsername" placeholder="Choose a username" autocomplete="username" required minlength="3">
                    </div>
                    <div class="form-group">
                        <label for="accountSignupCompany">Business Name</label>
                        <input type="text" id="accountSignupCompany" placeholder="Your business name" autocomplete="organization">
                    </div>
                    <div class="form-group">
                        <label for="accountSignupPassword">Password</label>
                        <input type="password" id="accountSignupPassword" placeholder="Choose a password (min 8 chars)" autocomplete="new-password" required minlength="8">
                    </div>
                    <div class="form-group">
                        <label for="accountSignupConfirm">Confirm Password</label>
                        <input type="password" id="accountSignupConfirm" placeholder="Confirm your password" autocomplete="new-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></line>
                        </svg>
                        Create Account
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p class="loading-text">Generating schedule...</p>
    </div>

    <!-- Pass data to JavaScript -->
    <script>
        const INITIAL_DATA = {
            business: {{ business | tojson }},
            businesses: {{ businesses | tojson }},
            employees: {{ employees | tojson }},
            roles: {{ roles | tojson }},
            days: {{ days | tojson }},
            daysOpen: {{ days_open | tojson }},
            hours: {{ hours | tojson }},
            startHour: {{ start_hour }},
            endHour: {{ end_hour }},
            initialTab: {{ initial_tab | tojson | default('"schedule"') }},
            initialPageSlug: {{ initial_page_slug | tojson | default('"schedule"') }},
            locationSlug: {{ location_slug | tojson | default('""') }},
            pageSlugs: {{ page_slugs | tojson | default('{}') }},
            tabToSlug: {{ tab_to_slug | tojson | default('{}') }},
            user: {% if user and user.is_authenticated %}{{ user.to_dict() | tojson }}{% else %}null{% endif %},
            isDemo: {{ is_demo | default(false) | tojson }}
        };
    </script>
    <script src="{{ url_for('static', filename='app.js') }}?v=5"></script>
</body>
</html>
